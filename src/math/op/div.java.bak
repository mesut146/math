package math.op;

import math.*;
import java.util.*;

public class div extends Func
{
	
    public div(Func f1,Func f2){
        a=f1;
        b=f2;
		type=types.div;
    }

    @Override
    public Func get(Variable v,double d)
    {
        return a.get(v,d).div(b.get(v,d));
    }

    @Override
    public Func derivative(Variable v)
    {

		return a.derivative(v).mul(b).sub(a.mul(b.derivative(v))).div(b.pow(2));
    }

    @Override
    public Func integrate(Variable v)
    {
        if(b.isConstant()){
            return a.integrate(v).div(b);
        }
        // 1/lnx  
        // 
        return new Anti(this);
    }
    
    @Override
    public String toString2()
    {
		StringBuilder sb=new StringBuilder();
		if(a.isConstant()||a.isVariable()){
			sb.append(a);
		}else{
			sb.append("("+a+")");
		}
		sb.append("/");
		if(b.isConstant()||b.isVariable()){
			sb.append(b);
		}else{
			sb.append("("+b+")");
		}
		return sb.toString();
    }
	
    public Func simplify(){
        if(a.is(0)){
            return Constant.ZERO;
        }
        if(a.isConstant()&&b.isConstant()){
            return new Constant(this.get(0));
        }
        if(a.isDiv()){
            return a.a.div(a.b.mul(b));
        }
		if(b.is(1)){
			return a;
		}
		if(a.eq(b)){
			return Constant.ONE;
		}
        List<Func> p=getFree();
		List<Func> q=getFree();
		List<Func> m=getFree();
		List<Func> n=getFree();
		if(a.isMul()){
			p.addAll(a.f);
		}else{
			p.add(a);
		}
		if(b.isMul()){
			q.addAll(b.f);
		}else{
			q.add(b);
		}
		boolean b[]=new boolean[q.size()];
		//(x^2)/(x^3)
		boolean simp=false;
		for(int i=0;i<p.size();i++){
			Func v=p.get(i);
			Func pow=v.isPow()?v.b:Constant.ONE;
			v=v.isPow()?v.a:v;
			for(int j=0;j<q.size();j++){
				if(!b[j]){
					t o;
					if((o=mul.e3(v,q.get(j))).b){
						b[j]=true;
						pow=pow.sub(o.f);
						simp=true;
					}
				}
			}
			m.add(v.pow(pow));
		}
		for(int j=0;j<q.size();j++){
			if(!b[j]){
				n.add(q.get(j));
			}
		}
        if(simp) return new div(new mul(m).simplify(),new mul(n).simplify()).simplify();
		
		return this;
    }
	
	public void group(){
		Func p=Constant.ONE;
		Func q=p;
		//(x^2+x)/x^3
		if(a.isAdd()){
			
		}
		if(b.isAdd()){
			
		}
		a=p;
		b=q;
	}
	
	private Func group0(add a){
		List<Func> l=a.f;
		//x^5+x^3
		List<Func> base=getFree();
		List<Func> pow=getFree();
		Func p=Constant.ONE;
		for(int i=0;i<l.size();i++){
			Func f=l.get(i);
			if(f.isPow()){
				base.add(f.a);
				pow.add(f.b);
				if(true){
					
				}
			}else{
				base.add(f);
				pow.add(Constant.ONE);
			}
		}
        return null;
	}

	@Override
	public boolean eq2(Func f)
	{
		if(a.eq(f.a)&&b.eq(f.b)){
			return true;
		}
		return false;
	}

    @Override
    public Func substitude(Variable v, Func p)
    {
        return a.substitude(v,p).div(b.substitude(v,p));
    }


	
	
}
